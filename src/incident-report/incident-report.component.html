<!-- Code for the CACC Equipment Falure Report Page -->

<!-- Header -->
<div class="container">
  <header align="center">
    <!-- Ontario Logo -->
    <img class="logo" src="OntarioMOH.png" alt="Ontario MOH Logo">

    <!-- Title -->
    <div name="title">
      <h1>
        CORTS - CACC Operational <br />
        Reports Tracking System
      </h1>
      <h3>454 - MIS CACC</h3>
    </div>

    <!-- Navigation Buttons -->
    <div name="nav">
      <button class="navBtn" routerLink="/mainpage">Start Page</button>
      <button class="navBtn" routerLink="/query">Search</button>
      <button class="navBtn" routerLink="/logout">Logout</button>
    </div>
  </header>
</div>

<!----------------------------------------------------------------->

<form id="IncidentReport">

  <!-- Basic Information -->
  <div class="container">
    <h2>Incident Report</h2>
    <hr />

    <h4>Basic Information:</h4>

    <!-- Basic Information Content -->
    <div class="grid-container">

      <!-- Created -->
      <div class="grid-item">
        <label>Created</label>
        <input type="text" [value]="fullDateTime" disabled />
      </div>

      <!-- COR # -->
      <div class="grid-item">
        <label>COR #</label>
        <input type="text" [value]="corNumber" disabled />
      </div>

      <!-- Due Date -->
      <div class="grid-item">
        <label>Due Date</label>
        <input type="text" [value]="dueDate" disabled />
      </div>

      <!-- Status -->
      <div class="grid-item">
        <label>Status</label>
        <input type="text" [value]="status" disabled />
      </div>

      <!-- COR Type -->
      <div class="grid-item">
        <label>COR Type</label>
        <input type="text" [value]="corType" disabled />
      </div>

      <!-- Creator -->
      <div class="grid-item">
        <!-- how do I fetch the current user information?-->
        <label>Creator</label>
        <input type="text" [value]="userName" disabled />
      </div>

      <!-- Route To -->
      <div class="grid-item">
        <label>Route To</label>
        <!-- how do I fetch the current user information?-->
        <select>
          <option selected>{{ userName }}</option>
          <option>{{ routedToGroup }}</option>
        </select>
      </div>

      <!-- Incident (Call) # -->
      <div class="grid-item">
        <label>Incident (Call) #</label>
        <input type="text" />
        <button>View in VisiCAD</button>
      </div>

      <!-- Related CORs -->
      <div class="grid-item">
        <label>Related CORs</label>
        <input
          type="text"
          [(ngModel)]="relatedCORsInput"
          name="relatedCORsInput"
        />
        <!-- Enter related COR number -->
        <select
          size="5"
          [(ngModel)]="selectedRelatedCOR"
          name="selectedRelatedCOR"
        >
          <option *ngFor="let cor of relatedCORs" [value]="cor">
            {{ cor }}
          </option>
        </select>
        <!-- Related COR Buttons -->
        <div class="form-actions">
          <button
            class="btn primary"
            (click)="addRelatedCOR($event)"
            type="button"
          >
            Add Related COR
          </button>
          <button
            class="btn warn"
            (click)="removeSelectedCOR($event)"
            type="button"
          >
            Remove Related COR
          </button>
        </div> <!-- End of Related COR Buttons-->
      </div> <!-- End of Related CORs-->
    </div> <!-- End of Basic Information Content -->
  </div> <!-- End of Basic Information (White Card) -->

  <!----------------------------------------------------------------->

  <!-- Incident Report -->
  <div class="container">
    <h4>Incident Report:</h4>
    <hr />

    <!-- Incident Report Content -->
    <div class="grid-container">

      <!-- Incident Type -->
      <div class="grid-item">
        <label class="req-input">Incident Type*</label>
        <select [(ngModel)]="incidentType" name="incidentType" required>
          <option value="">-- Select Incident Type --</option>
          <option value="1">Delay in Response</option>
          <option value="2">MCI</option>
          <option value="3">Other</option>
          <option value="4">Unusual Occurrence</option>
        </select>
      </div>

      <!-- Date/Time of Incident -->
      <div class="grid-item">
        <label class="req-input" for="DateTimeofIncident">Date/Time of Incident*</label>
        <input type="datetime-local" id="DateTimeofIncident" [(ngModel)]="incidentDateTime" name="incidentDateTime" required />
      </div>

      <!-- Incident Details -->
      <div class="grid-item">
        <label class="req-input">Incident Details*</label>
        <textarea
          rows="5"
          maxlength="255"
          [(ngModel)]="incidentCommentText"
          name="incidentCommentText"
        ></textarea>
      </div>
    </div> <!-- End of Incident Report Details -->
  </div> <!-- End of Incident Report (White Card)-->

  <!----------------------------------------------------------------->

  <!-- Narrative -->
  <div class="container">
    <h4>Narrative:</h4>
    <hr />

    <!-- Narative Table -->
    <table width="100%">
      <thead>
        <tr>
          <th width="10%">Date</th>
          <th width="13%">Time</th>
          <th width="10%">User</th>
          <th>Comments</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let entry of combinedEntries">
          <td>{{ entry.date }}</td>
          <td>{{ entry.time }}</td>
          <td>{{ entry.user }}</td>
          <td
            [ngClass]="{
              'incident-comment': entry.type === 'incident',
              'narrative-comment': entry.type === 'narrative'
            }"
            name="incidentComment"
          >
            {{ entry.comment }}
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Narrative Container for content under the table -->
    <div class="narrative-container">
      <!-- Narrative Comments -->
      <div class="grid-item">
        <label>Comments</label>
        <textarea
          rows="5"
          maxlength="255"
          [(ngModel)]="narrativeCommentText"
          name="narrativeCommentText"
        ></textarea>
      </div>

      <!-- Form Action Buttons -->
      <div class="form-actions">
        <button class="btn primary" (click)="saveChanges()">
          Save Changes
        </button>
        <button class="btn primary">
          Save Changes and Exit
        </button>
        <button class="btn warn">Reload Page</button>
      </div>
    </div>
    <!-- End Narrative Container -->
  </div>
  <!-- End of Narrative (White Card)-->
</form>
